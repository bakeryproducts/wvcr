# Архитектура WVCR - Рефакторинг

## Обзор
Код был рефакторен для улучшения читаемости, поддерживаемости и расширяемости. Основные изменения:

## Новая структура

### `src/wvcr/modes/` - Режимы обработки
- `__init__.py` - Экспорт всех режимов и ProcessingMode enum
- `base.py` - Базовый класс BaseMode для всех режимов
- `transcribe_mode.py` - Режим простой транскрипции
- `transcribe_url_mode.py` - Режим транскрипции аудио/видео по URL
- `answer_mode.py` - Режим ответов на вопросы
- `explain_mode.py` - Режим объяснений с контекстом
- `voiceover_mode.py` - Режим озвучки текста
- `factory.py` - Фабрика для создания экземпляров режимов

### `src/wvcr/services/` - Сервисы
- `__init__.py` - Экспорт всех сервисов
- `transcription_service.py` - Транскрипция аудио через OpenAI
- `text_processing_service.py` - Обработка текста через OpenAI
- `file_service.py` - Работа с файлами
- `download_service.py` - Скачивание и обработка аудио/видео по URL

## Основные преимущества

1. **Четкое разделение ответственности**: каждый режим - отдельный класс
2. **Переиспользование кода**: сервисы используются разными режимами
3. **Легкое расширение**: добавление нового режима требует создания одного файла
4. **Лучшая тестируемость**: каждый компонент изолирован
5. **Упрощенный main.py**: только координация между компонентами

## Как добавить новый режим

1. Создать новый файл в `src/wvcr/modes/new_mode.py`
2. Наследоваться от `BaseMode`
3. Реализовать метод `process()`
4. Добавить новый режим в `ProcessingMode` enum
5. Добавить в фабрику в `factory.py`
6. Добавить в choices в `main.py`

## Удаленные файлы
- `openai_client.py` - функциональность перенесена в сервисы и режимы

## Сохраненная функциональность
- Все режимы работы (transcribe, transcribe_url, answer, explain, voiceover)
- Запись и воспроизведение аудио
- Уведомления
- Работа с буфером обмена
- История запросов
- Все параметры командной строки

## Новый режим transcribe_url
- Читает URL из буфера обмена
- Поддерживает YouTube видео и прямые ссылки на аудио/видео файлы
- Извлекает аудиодорожку из видео
- Опциональная обработка аудио (нормализация, шумоподавление)
- Использует существующий сервис транскрипции OpenAI
